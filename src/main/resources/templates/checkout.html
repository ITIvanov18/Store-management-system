<!DOCTYPE html>
<html lang="bg" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>–§–∏–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω–µ –Ω–∞ –ø–æ–∫—É–ø–∫–∞—Ç–∞</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/checkout.css}" href="/css/checkout.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script th:src="@{/js/checkout.js}" src="/js/checkout.js"></script>


</head>
<body class="bg-dark text-white">

<div class="container py-5">
    <h2 class="text-center mb-4">–ü—Ä–µ–≥–ª–µ–¥ –Ω–∞ –ø–æ–∫—É–ø–∫–∞—Ç–∞</h2>

    <div class="card bg-secondary p-4">
        <h5>–ú–∞–≥–∞–∑–∏–Ω: <span th:text="${store.storeName}">–ò–º–µ –Ω–∞ –º–∞–≥–∞–∑–∏–Ω–∞</span></h5>
        <h6>–ö–∞—Å–∏–µ—Ä: <span th:text="${cashier.cashierName}">–ò–º–µ</span></h6>
        <h6>–ö–∞—Å–∞: ‚Ññ<span th:text="${register.id}">1</span></h6>
        <h6>–î–∞—Ç–∞ –∏ —á–∞—Å: <span th:text="${#temporals.format(#temporals.createNow(),  'dd-MM-yyyy HH:mm')}">–¥–∞—Ç–∞</span></h6>
    </div>

    <table class="table table-striped table-dark mt-4">
        <thead>
        <tr>
            <th>–ü—Ä–æ–¥—É–∫—Ç</th>
            <th>–¶–µ–Ω–∞</th>
            <th>–ë—Ä.</th>
            <th>–û–±—â–æ</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="entry : ${purchased.entrySet()}">
            <td th:text="${entry.key.productName}">–ò–º–µ</td>
            <td th:text="${productPrices[entry.key.id]}">0.00</td>
            <td th:text="${entry.value}">0</td>
            <td th:text="${#numbers.formatDecimal(productPrices[entry.key.id] * entry.value, 1, 'COMMA', 2, 'POINT')}">0.00</td>
        </tr>
        </tbody>
    </table>

    <form id="finalizeForm" th:action="@{'/purchase/store/' + ${store.id} + '/finalize'}" method="post">
        <input type="hidden" name="cashRegisterId" th:value="${register.id}" />
    </form>

    <div class="text-center mt-4">
        <button type="button" class="btn btn-primary btn-lg px-5" onclick="showPaymentModal()">üí≥ –ü–ª–∞—Ç–∏</button>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª –∑–∞ –ø–æ—Ç–≤—ä—Ä–∂–¥–µ–Ω–∏–µ -->
<div class="modal fade" id="confirmPaymentModal" tabindex="-1" aria-labelledby="confirmPaymentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content bg-dark text-white text-center">
            <div class="modal-header border-0">
                <h5 class="modal-title w-100" id="confirmPaymentModalLabel">–ü–æ—Ç–≤—ä—Ä–¥–∏ –ø–ª–∞—â–∞–Ω–µ</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="–ó–∞—Ç–≤–æ—Ä–∏"></button>
            </div>
            <div class="modal-body">
                –ñ–µ–ª–∞–µ—Ç–µ –ª–∏ –¥–∞ —Ñ–∏–Ω–∞–ª–∏–∑–∏—Ä–∞—Ç–µ –ø–æ–∫—É–ø–∫–∞—Ç–∞?
            </div>
            <div class="modal-footer justify-content-center border-0">
                <button type="submit" class="btn btn-success" form="finalizeForm">‚úÖ –î–∞, –ø–ª–∞—â–∞–º</button>
                <button type="button" class="btn btn-danger" onclick="showPaymentFailure()">‚ùå –ù—è–º–∞ –¥–æ—Å—Ç–∞—Ç—ä—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤–∞</button>
            </div>
        </div>
    </div>
</div>

<!-- –£—Å–ø–µ—à–Ω–æ –ø–ª–∞—â–∞–Ω–µ Modal -->
<div class="modal fade" id="successPaymentModal" tabindex="-1" aria-labelledby="successPaymentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content bg-success text-white text-center">
            <div class="modal-header border-0">
                <h5 class="modal-title w-100" id="successPaymentModalLabel">–£—Å–ø–µ—à–Ω–æ –ø–ª–∞—â–∞–Ω–µ ‚úî</h5>
            </div>
            <div class="modal-body">
                –ë–ª–∞–≥–æ–¥–∞—Ä–∏–º –∑–∞ –ø–æ–∫—É–ø–∫–∞—Ç–∞! –ö–∞—Å–æ–≤–∞—Ç–∞ –±–µ–ª–µ–∂–∫–∞ –µ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–∞.
            </div>
        </div>
    </div>
</div>

<th:block th:if="${showSuccess}">
    <script>showSuccessModalAndRedirect();</script>
</th:block>

</body>
</html>
